(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{129:function(t,e,n){},131:function(t,e,n){n(132),t.exports=n(335)},318:function(t,e,n){},328:function(t,e,n){},329:function(t,e,n){},330:function(t,e,n){},331:function(t,e,n){},332:function(t,e,n){},333:function(t,e,n){},334:function(t,e,n){},335:function(t,e,n){"use strict";n.r(e),n.d(e,"addColumnEvent",(function(){return q})),n.d(e,"addTaskEvent",(function(){return $})),n.d(e,"deleteColumnEvent",(function(){return U})),n.d(e,"taskMovedEvent",(function(){return z})),n.d(e,"taskStartDragEvent",(function(){return F}));n(318);var s=n(51),i=n.n(s);n(322),n(326);i.a.initializeApp({apiKey:"AIzaSyDVAtIUk1SXbrnZA-3ABqT53P3sekO-bKQ",authDomain:"bwt---project-cg-59728.firebaseapp.com",databaseURL:"https://bwt---project-cg-59728.firebaseio.com",projectId:"bwt---project-cg-59728",storageBucket:"bwt---project-cg-59728.appspot.com",messagingSenderId:"629788569759",appId:"1:629788569759:web:80a05f2306c287677e72aa"});const o=i.a.database(),r=new i.a.auth.GoogleAuthProvider;n(328),n(329);var a=n(45),d=n.n(a),l=n(46),h=n.n(l),c=new d.a({id:"close",use:"close-usage",viewBox:"0 0 15 15",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" id="close"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.5 6.719L14.219 0 15 .781 8.281 7.5 15 14.219l-.781.781L7.5 8.281.781 15 0 14.219 6.719 7.5 0 .781.781 0 7.5 6.719z" /></symbol>'}),u=(h.a.add(c),c);var m=class{constructor({placeholder:t,btnTitle:e,inputName:n,onCloseHandler:s,tag:i="input",inputValue:o="",inputRequired:r}){this.placeholder=t,this.btnTitle=e,this.inputName=n,this.inputValue=o,this.onCloseHandler=s,this.tag=i,this.inputRequired=r,this.formData={},this.root=document.createElement("div"),this.input=null,this.formChanged=!1,this.render=this.render.bind(this),this.onSubmit=this.onSubmit.bind(this),this.onCloseClick=this.onCloseClick.bind(this),this.onInputChange=this.onInputChange.bind(this)}onSubmit(t){t.preventDefault()}onCloseClick(){this.input.value="",this.onCloseHandler()}onInputChange(t){const{name:e,value:n}=t.target;this.formData[e]=n,this.formChanged||(this.formChanged=!0)}getInputElement(){const t=document.createElement(this.tag);return t.className="add-form__text",t.placeholder=this.placeholder,t.name=this.inputName,t.value=this.inputValue,t.required=this.inputRequired,t.onchange=this.onInputChange,t}getButtonElement(){const t=document.createElement("button");return t.classList.add("add-form__button"),t.type="submit",t.innerText=this.btnTitle,t}getCloseElement(){const t=document.createElement("div");return t.className="add-form__icon-wrapper",t.innerHTML=`<svg class="icon add-form__icon"><use xlink:href="#${u.id}" /></svg>`,t.onclick=this.onCloseClick,t}render(){const t=document.createElement("form");t.onsubmit=this.onSubmit,t.classList.add("add-form"),this.input=this.getInputElement(),t.appendChild(this.input);const e=document.createElement("div");return e.className="add-form__actions",e.appendChild(this.getButtonElement()),e.appendChild(this.getCloseElement()),t.appendChild(e),setTimeout(()=>{this.input.focus()},0),t}};var p=class{constructor(){this.open=!1,this.element=null,this.root=document.createElement("div"),this.onAdd=this.onAdd.bind(this),this.onClose=this.onClose.bind(this)}updateRender(){this.element.remove(),this.render()}onClose(){this.open=!1,this.updateRender()}onAdd(){this.open=!0,this.updateRender()}getElement(){}render(){return this.element=this.getElement(),this.root.appendChild(this.element),this.root}};var b=class{constructor({description:t}){this.description=t}save(t){return o.ref(`columns/${t}/tasks`).push({description:this.description})}static edit(t,e,n){if(e&&n)return o.ref(`columns/${t}/tasks/${e}`).update(n)}static delete(t,e){if(e)return o.ref(`columns/${t}/tasks/${e}`).remove()}};var E=class extends m{constructor(t,e){super({placeholder:"Введите название карточки",btnTitle:"Добавить карточку",inputName:"description",onCloseHandler:t,tag:"textarea",inputRequired:!0}),this.columnId=e}getInputElement(){const t=super.getInputElement();return t.classList.add("add-task-text"),t}onSubmit(t){super.onSubmit(t),this.formChanged&&new b({description:this.formData.description}).save(this.columnId).then(t=>{this.onCloseClick(),$.fire({task:{id:t.key,description:this.formData.description},columnId:this.columnId})}).catch(t=>console.log(t))}render(){return this.root.classList.add("add-task-element"),super.render()}},C=(n(330),new d.a({id:"plus",use:"plus-usage",viewBox:"0 0 15 15",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" id="plus"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.141 6.641H8.36V.86A.88.88 0 007.5 0a.88.88 0 00-.859.859V6.64H.86A.88.88 0 000 7.5c0 .458.4.859.859.859H6.64v5.782c0 .458.401.859.859.859a.88.88 0 00.859-.859V8.36h5.782A.88.88 0 0015 7.5a.88.88 0 00-.859-.859z" /></symbol>'})),g=(h.a.add(C),C);var v=class{constructor(t,e){this.title=t,this.onAddHandler=e,this.element=null,this.root=document.createElement("div")}render(){const t=document.createElement("div");return t.classList.add("add-element"),t.innerHTML=`\n      <div class="add-element__icon-wrapper"><svg class="icon"><use xlink:href="#${g.id}" /></svg></div> ${this.title}\n    `,t.onclick=this.onAddHandler,t}};var k=class extends p{constructor(t){super(),this.columnId=t}getElement(){return this.open?new E(this.onClose,this.columnId).render():new v("Добавить еще одну карточку",this.onAdd).render()}render(){return this.element=this.getElement(),this.root.className="add-new-task",this.root.appendChild(this.element),this.root}};n(129);var f=class extends m{constructor({onCloseHandler:t,inputValue:e,onSubmit:n,taskId:s,columnId:i}){super({placeholder:"Введите название карточки",btnTitle:"Редактировать карточку",inputName:"description",inputValue:e,onCloseHandler:t,tag:"textarea",inputRequired:!0}),this.onSubmitCallback=n,this.taskId=s,this.columnId=i}getInputElement(){const t=super.getInputElement();return t.classList.add("add-task-text"),t}onSubmit(t){super.onSubmit(t),b.edit(this.columnId,this.taskId,{description:this.formData.description}).then(t=>{this.onSubmitCallback(this.formData.description),this.onCloseClick()}).catch(t=>console.log(t))}render(){return this.root.classList.add("add-task-element"),super.render()}},w=new d.a({id:"more",use:"more-usage",viewBox:"0 0 515.555 515.555",content:'<symbol viewBox="0 0 515.555 515.555" xmlns="http://www.w3.org/2000/svg" id="more"><path d="M496.679 212.208c25.167 25.167 25.167 65.971 0 91.138s-65.971 25.167-91.138 0-25.167-65.971 0-91.138 65.971-25.167 91.138 0M303.347 212.208c25.167 25.167 25.167 65.971 0 91.138s-65.971 25.167-91.138 0-25.167-65.971 0-91.138 65.971-25.167 91.138 0M110.014 212.208c25.167 25.167 25.167 65.971 0 91.138s-65.971 25.167-91.138 0-25.167-65.971 0-91.138 65.971-25.167 91.138 0" /></symbol>'}),I=(h.a.add(w),w);n(331);var T=class{constructor(t=[]){this.menuOptions=t,this.isOpen=!1,this.onMenuOpen=this.onMenuOpen.bind(this),this.onMenuClose=this.onMenuClose.bind(this),this.dropdownElement=null,this.menuBtn=null,this.clickAwayListener=this.clickAwayListener.bind(this),this.events()}events(){document.addEventListener("click",this.clickAwayListener)}removeListeners(){document.removeEventListener("click",this.clickAwayListener)}clickAwayListener(t){this.menuBtn.contains(t.target)||!this.dropdownElement||this.dropdownElement.contains(t.target)||this.onMenuClose()}createDropdownMenuItem({name:t,handler:e}){const n=document.createElement("div");return n.className="menu__dropdown-item",n.innerHTML=t,n.onclick=e,n}createDropdownMenu(){const t=document.createElement("div");return t.className="menu__dropdown",this.menuOptions.forEach(e=>{t.appendChild(this.createDropdownMenuItem(e))}),t}createButton(){const t=document.createElement("div");return t.innerHTML=`<svg class="icon"><use xlink:href="#${I.id}" /></svg>`,t.className="menu__button",t.onclick=this.onMenuOpen,t}onMenuOpen(t){if(this.isOpen)return;this.isOpen=!0;let e=document.getElementById("portal");const n=document.getElementById("column-list");e||(e=this.createDropDownPortal()),n.appendChild(e),this.dropdownPortal||(this.dropdownElement=this.createDropdownMenu(),e.appendChild(this.dropdownElement));const s=this.menuBtn.getBoundingClientRect(),i=document.getElementById("board");this.dropdownElement.style.top=s.top+this.menuBtn.clientHeight-5-i.offsetTop-n.offsetTop+"px",this.dropdownElement.style.left=s.left+n.scrollLeft-this.menuBtn.offsetWidth/2+"px",this.dropdownElement.classList.add("menu__dropdown--open")}onMenuClose(){this.isOpen=!1,this.dropdownElement&&this.dropdownElement.remove()}createDropDownPortal(){const t=document.createElement("div");t.id="portal";document.getElementById("column-list");return t}render(){const t=document.createElement("div");return t.className="menu",this.menuBtn=this.createButton(),t.appendChild(this.menuBtn),t}};n(332);var L=class{constructor(t){this.content=t}createModalElement(){const t=document.createElement("div");return t.className="modal",t}render(){const t=document.createElement("div");t.className="modal-wrapper";const e=this.createModalElement();e.appendChild(this.content),t.appendChild(e);return document.getElementById("modal-portal").appendChild(t),t}};var M=class{constructor(t,e){this.task=t,this.columnId=e,this.updateTask=this.updateTask.bind(this),this.deleteTask=this.deleteTask.bind(this),this.onEdit=this.onEdit.bind(this),this.hideModal=this.hideModal.bind(this),this.updateColumnId=this.updateColumnId.bind(this),this.onTaskStartDrag=this.onTaskStartDrag.bind(this),this.menuOptions=[{name:"Редактировать",handler:this.updateTask},{name:"Удалить",handler:this.deleteTask}],this.menu=new T(this.menuOptions),this.root=document.createElement("div"),this.modal=null,this.descriptionElement=null,this.onTaskMovedSubId=z.subscribe(this.updateColumnId),this.onTaskDragStartSubId=F.subscribe(this.onTaskStartDrag)}onTaskStartDrag(t){t===this.task.id&&this.menu.isOpen&&this.menu.onMenuClose()}updateColumnId({taskId:t,columnIdTo:e,columnIdFrom:n}){t===this.task.id&&(this.columnId=e,b.delete(n,this.task.id),new b(this.task).save(e))}deleteTask(){b.delete(this.columnId,this.task.id).then(()=>{this.menu.removeListeners(),z.unsubscribe(this.onTaskMovedSubId),F.unsubscribe(this.onTaskDragStartSubId),this.root.remove(),this.menu.onMenuClose()}).catch(t=>console.log(t))}updateTask(){this.menu.onMenuClose(),this.showModal()}onEdit(t){this.task.description=t,this.descriptionElement.innerText=t}showModal(){const t=document.createElement("div");t.className="modal-content";const e=new f({onSubmit:this.onEdit,onCloseHandler:this.hideModal,inputValue:this.task.description,taskId:this.task.id,columnId:this.columnId}).render();t.appendChild(e),this.modal=new L(t).render()}hideModal(){this.modal.remove()}createTaskElement(){const t=document.createElement("div");t.className="task__inner";const e=document.createElement("div");e.innerText=this.task.description,e.className="task__text",this.descriptionElement=e,t.appendChild(e);const n=document.createElement("div");n.className="task__actions",t.appendChild(n);const s=this.menu.render();return n.appendChild(s),t}render(){return this.root.className="task",this.root.setAttribute("data-id",this.task.id),this.root.appendChild(this.createTaskElement()),this.root}};var S=class{constructor(t=[],e){this.tasks=t,this.columnId=e,this.tasksListElement=document.createElement("div"),this.tasksListElement.className="tasks-list",this.addTask=this.addTask.bind(this),this.onDeleteColumn=this.onDeleteColumn.bind(this),this.addTaskEventSubId=$.subscribe(this.addTask),this.deleteColumnEventSubId=U.subscribe(this.onDeleteColumn)}onDeleteColumn(t){this.columnId===t&&($.unsubscribe(this.addTaskEventSubId),U.unsubscribe(this.deleteColumnEventSubId))}addTask({task:t,columnId:e}){this.columnId===e&&(this.tasks.push(t),this.tasksListElement.appendChild(new M(t,this.columnId).render()))}render(){return this.tasks.forEach(t=>{this.tasksListElement.appendChild(new M(t,this.columnId).render())}),this.tasksListElement.setAttribute("data-id",this.columnId),this.tasksListElement}};function x(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function D(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var N=class{constructor({title:t,tasks:e}){this.title=t,this.tasks=e}save(){if(this.title)return o.ref("columns").push({title:this.title})}static edit(t,e){if(t)return o.ref("columns/"+t).update({title:e})}static fetchAll(){return o.ref("columns").once("value").then(t=>{const e=[];return t.forEach(t=>{const{title:n,tasks:s}=t.val();let i;i=s?Object.entries(s).map(([t,e])=>function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?x(Object(n),!0).forEach((function(e){D(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):x(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({id:t},e)):[],e.push({id:t.key,title:n,tasks:i})}),e})}static delete(t){return o.ref("columns/"+t).remove()}};var _=class extends m{constructor({onCloseHandler:t,inputValue:e,onSubmit:n,columnId:s}){super({placeholder:"Введите название колонки",btnTitle:"Редактировать колонку",inputName:"title",inputValue:e,onCloseHandler:t,inputRequired:!0}),this.columnId=s,this.onSubmitCallback=n}onSubmit(t){super.onSubmit(t),N.edit(this.columnId,this.formData.title).then(t=>{this.onSubmitCallback(this.formData.title),this.onCloseClick(this.formData.title)}).catch(t=>console.log(t))}render(){return this.root.classList.add("add-column-element"),super.render()}},y=n(130);var O=class{constructor({id:t,title:e,tasks:n=[]}){this.id=t,this.title=e,this.tasks=n,this.updateColumn=this.updateColumn.bind(this),this.deleteColumn=this.deleteColumn.bind(this),this.onEdit=this.onEdit.bind(this),this.hideModal=this.hideModal.bind(this),this.onDragStart=this.onDragStart.bind(this),this.saveColumnPosition=this.saveColumnPosition.bind(this),this.menuOptions=[{name:"Редактировать",handler:this.updateColumn},{name:"Удалить",handler:this.deleteColumn}],this.menu=new T(this.menuOptions),this.modal=null,this.columnTitleElement=null,this.root=document.createElement("div")}updateColumn(){this.menu.onMenuClose(),this.showModal()}deleteColumn(){N.delete(this.id).then(()=>{this.menu.removeListeners(),U.fire(this.id),this.root.remove(),this.menu.onMenuClose()})}onEdit(t){this.columnTitleElement.innerText=t}showModal(){const t=document.createElement("div");t.className="modal-content";const e=new _({onSubmit:this.onEdit,onCloseHandler:this.hideModal,inputValue:this.title,columnId:this.id}).render();t.appendChild(e),this.modal=new L(t).render()}hideModal(){this.modal.remove()}createAddNewTaskElement(){return new k(this.id).render()}createHeaderElement(){const t=document.createElement("div");t.className="column__header";const e=document.createElement("div");e.innerText=this.title,e.className="column__title",this.columnTitleElement=e,t.appendChild(e);const n=document.createElement("div");n.className="column__actions";const s=this.menu.render();return n.appendChild(s),t.appendChild(n),t}saveColumnPosition(t){const e=t.from.dataset.id;if(e!==this.id){const n=t.clone.dataset.id;z.fire({columnIdTo:this.id,taskId:n,columnIdFrom:e})}}onDragStart(t){const e=t.item.dataset.id;F.fire(e)}render(){this.root.className="column-wrapper";const t=document.createElement("div");t.classList="column";const e=this.createHeaderElement();t.appendChild(e);const n=new S(this.tasks,this.id).render(),s=(y.a.create(n,{group:"columns",ghostClass:"task__ghost",chosenClass:"task__chosen",dragClass:"task__drag",forceFallback:!0,filter:".menu",onStart:this.onDragStart,onAdd:this.saveColumnPosition}),document.createElement("div"));return s.className="tasks-wrapper",s.appendChild(n),t.appendChild(s),t.appendChild(this.createAddNewTaskElement()),this.root.appendChild(t),this.root}};var A=class extends m{constructor(t){super({placeholder:"Введите название колонки",btnTitle:"Добавить колонку",inputName:"title",onCloseHandler:t,inputRequired:!0})}onSubmit(t){super.onSubmit(t),this.formChanged&&new N({title:this.formData.title}).save().then(t=>{this.onCloseClick(),q.fire({id:t.key,title:this.formData.title})}).catch(t=>console.log(t))}render(){return this.root.classList.add("add-column-element"),super.render()}};var B=class extends p{constructor(){super()}getElement(){return this.open?new A(this.onClose).render():new v("Добавить еще одну колонку",this.onAdd).render()}render(){return super.render(),this.root.className="add-column-element",this.root}};n(333);var H=class{constructor(t=[]){this.columns=t,this.addColumnElement=null,this.root=document.createElement("div"),this.columnListElement=document.createElement("div"),this.appendColumn=this.appendColumn.bind(this),this.subId=q.subscribe(this.appendColumn)}appendColumn(t){this.addColumnElement.insertAdjacentElement("beforebegin",this.getColumnElement(t))}getCreateNewColumnElement(){const t=document.createElement("div");return t.className="column-wrapper",t.appendChild((new B).render()),t}getColumnElement(t){return new O(t).render()}render(){return this.columns.forEach(t=>{this.columnListElement.appendChild(this.getColumnElement(t))}),this.addColumnElement=this.getCreateNewColumnElement(),this.columnListElement.appendChild(this.addColumnElement),this.columnListElement.className="column-list",this.columnListElement.id="column-list",this.root.appendChild(this.columnListElement),this.root.className="board",this.root.id="board",this.root}};n(334);var j=class{constructor(t){this.root=document.createElement("header"),this.onLogin=this.onLogin.bind(this),this.onLogout=this.onLogout.bind(this),this.createUserIfoBlock=this.createUserIfoBlock.bind(this),this.user=t,this.buttonElement=null,this.userInfoElement=null,this.btnLoginText="Войти с Google",this.btnLogoutText="Выйти"}onLogin(){this.user.login().then(()=>{this.buttonElement.innerText=this.btnLogoutText,this.buttonElement.onclick=this.onLogout,this.userInfoElement=this.createUserIfoBlock(this.user.user.displayName),this.root.prepend(this.userInfoElement)}).catch(t=>console.log(t))}onLogout(){this.user.logout().then(()=>{this.buttonElement.innerText=this.btnLoginText,this.buttonElement.onclick=this.onLogin,this.userInfoElement.innerText=""}).catch(t=>console.log(t))}createLoginButton(){const t=document.createElement("button");return t.className="header__login-btn",t.type="button",t.innerText=this.btnLoginText,t.onclick=this.onLogin,t}createUserIfoBlock(t){const e=document.createElement("div");return e.className="header__user-info",e.innerText=t,e}render(){return this.root.className="header",this.buttonElement=this.createLoginButton(),this.root.appendChild(this.buttonElement),this.root}};var P=class{constructor(){this.isAuthenticated=!1,this.user=null}login(){return i.a.auth().signInWithPopup(r).then(t=>{this.user=t.user,this.isAuthenticated=!0}).catch(t=>{throw t})}logout(){return i.a.auth().signOut().then(()=>{this.isAuthenticated=!1}).catch(t=>{throw t})}};var V=class{constructor(){this.root=document.getElementById("app"),this.init=this.init.bind(this),this.render=this.render.bind(this),this.user=new P,this.loadingElement=document.createElement("div"),this.loadingElement.className="loading",this.loadingElement.innerText="Loading..."}async init(){this.root.appendChild(this.loadingElement);const t=await N.fetchAll();return this.loadingElement.remove(),t}render(t){this.root.appendChild(new j(this.user).render()),this.root.appendChild(new H(t).render())}};var R=class{constructor(){this.handlers=new Map,this.count=0}subscribe(t){return this.handlers.set(++this.count,t),this.count}unsubscribe(t){this.handlers.delete(t)}fire(t){this.handlers.forEach(e=>{e(t)})}};const q=new R,$=new R,U=new R,z=new R,F=new R;document.addEventListener("DOMContentLoaded",()=>{const t=new V;t.init().then(e=>{t.render(e)})})}},[[131,1,2]]]);