(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,,function(t,e,n){},,function(t,e,n){},,,,,,,,,,function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){},function(t,e,n){"use strict";n.r(e),n.d(e,"addColumnEvent",(function(){return j})),n.d(e,"addTaskEvent",(function(){return U})),n.d(e,"deleteColumnEvent",(function(){return R})),n.d(e,"taskMovedEvent",(function(){return z}));n(10);var s=n(3),i=n.n(s);n(14),n(18);i.a.initializeApp({apiKey:"AIzaSyDVAtIUk1SXbrnZA-3ABqT53P3sekO-bKQ",authDomain:"bwt---project-cg-59728.firebaseapp.com",databaseURL:"https://bwt---project-cg-59728.firebaseio.com",projectId:"bwt---project-cg-59728",storageBucket:"bwt---project-cg-59728.appspot.com",messagingSenderId:"629788569759",appId:"1:629788569759:web:80a05f2306c287677e72aa"});const o=i.a.database(),d=new i.a.auth.GoogleAuthProvider;n(20),n(21);var l=n(1),r=n.n(l),a=n(2),h=n.n(a),c=new r.a({id:"close",use:"close-usage",viewBox:"0 0 15 15",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" id="close"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.5 6.719L14.219 0 15 .781 8.281 7.5 15 14.219l-.781.781L7.5 8.281.781 15 0 14.219 6.719 7.5 0 .781.781 0 7.5 6.719z" /></symbol>'}),u=(h.a.add(c),c);var m=class{constructor({placeholder:t,btnTitle:e,inputName:n,onCloseHandler:s,tag:i="input",inputValue:o=""}){this.placeholder=t,this.btnTitle=e,this.inputName=n,this.inputValue=o,this.onCloseHandler=s,this.tag=i,this.formData={},this.root=document.createElement("div"),this.input=null,this.formChanged=!1,this.render=this.render.bind(this),this.onSubmit=this.onSubmit.bind(this),this.onCloseClick=this.onCloseClick.bind(this),this.onInputChange=this.onInputChange.bind(this)}onSubmit(t){t.preventDefault()}onCloseClick(){this.input.value="",this.onCloseHandler()}onInputChange(t){const{name:e,value:n}=t.target;this.formData={...this.formData,[e]:n},this.formChanged||(this.formChanged=!0)}getInputElement(){const t=document.createElement(this.tag);return t.className="add-form__text",t.placeholder=this.placeholder,t.name=this.inputName,t.value=this.inputValue,t.onchange=this.onInputChange,t}getButtonElement(){const t=document.createElement("button");return t.classList.add("add-form__button"),t.type="submit",t.innerText=this.btnTitle,t}getCloseElement(){const t=document.createElement("div");return t.className="add-form__icon-wrapper",t.innerHTML=`<svg class="icon add-form__icon"><use xlink:href="#${u.id}" /></svg>`,t.onclick=this.onCloseClick,t}render(){const t=document.createElement("form");t.onsubmit=this.onSubmit,t.classList.add("add-form"),this.input=this.getInputElement(),t.appendChild(this.input);const e=document.createElement("div");return e.className="add-form__actions",e.appendChild(this.getButtonElement()),e.appendChild(this.getCloseElement()),t.appendChild(e),setTimeout(()=>{this.input.focus()},0),t}};var p=class{constructor({description:t,columnId:e}){this.description=t,this.columnId=e}save(){return o.ref("tasks").push({description:this.description,columnId:this.columnId})}static edit(t,e){if(t&&e)return o.ref("tasks/"+t).update(e)}static delete(t){if(t)return o.ref("tasks/"+t).remove()}static fetchAll(){return o.ref("tasks").once("value").then(t=>{const e=[];return t.forEach(t=>{e.push({id:t.key,...t.val()})}),e})}};var C=class{constructor(){this.open=!1,this.element=null,this.root=document.createElement("div"),this.onAdd=this.onAdd.bind(this),this.onClose=this.onClose.bind(this)}updateRender(){this.element.remove(),this.render()}onClose(){this.open=!1,this.updateRender()}onAdd(){this.open=!0,this.updateRender()}getElement(){}render(){return this.element=this.getElement(),this.root.appendChild(this.element),this.root}};var b=class extends m{constructor(t,e){super({placeholder:"Введите название карточки",btnTitle:"Добавить карточку",inputName:"description",onCloseHandler:t,tag:"textarea"}),this.columnId=e}getInputElement(){const t=super.getInputElement();return t.classList.add("add-task-text"),t}onSubmit(t){super.onSubmit(t),this.formChanged&&new p({description:this.formData.description,columnId:this.columnId}).save().then(t=>{this.onCloseClick(),U.fire({id:t.key,description:this.formData.description,columnId:this.columnId})}).catch(t=>console.log(t))}render(){return this.root.classList.add("add-task-element"),super.render()}},E=(n(22),new r.a({id:"plus",use:"plus-usage",viewBox:"0 0 15 15",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 15" id="plus"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.141 6.641H8.36V.86A.88.88 0 007.5 0a.88.88 0 00-.859.859V6.64H.86A.88.88 0 000 7.5c0 .458.4.859.859.859H6.64v5.782c0 .458.401.859.859.859a.88.88 0 00.859-.859V8.36h5.782A.88.88 0 0015 7.5a.88.88 0 00-.859-.859z" /></symbol>'})),v=(h.a.add(E),E);var k=class{constructor(t,e){this.title=t,this.onAddHandler=e,this.element=null,this.root=document.createElement("div")}render(){const t=document.createElement("div");return t.classList.add("add-element"),t.innerHTML=`\n      <div class="add-element__icon-wrapper"><svg class="icon"><use xlink:href="#${v.id}" /></svg></div> ${this.title}\n    `,t.onclick=this.onAddHandler,t}};var g=class extends C{constructor(t){super(),this.columnId=t}getElement(){return this.open?new b(this.onClose,this.columnId).render():new k("Добавить еще одну карточку",this.onAdd).render()}render(){return this.element=this.getElement(),this.root.className="add-new-task",this.root.appendChild(this.element),this.root}};n(8);var w=class extends m{constructor({onCloseHandler:t,inputValue:e,onSubmit:n,taskId:s}){super({placeholder:"Введите название карточки",btnTitle:"Редактировать карточку",inputName:"description",inputValue:e,onCloseHandler:t,tag:"textarea"}),this.onSubmitCallback=n,this.taskId=s}getInputElement(){const t=super.getInputElement();return t.classList.add("add-task-text"),t}onSubmit(t){super.onSubmit(t),p.edit(this.taskId,{description:this.formData.description}).then(t=>{this.onSubmitCallback(this.formData.description),this.onCloseClick()}).catch(t=>console.log(t))}render(){return this.root.classList.add("add-task-element"),super.render()}},f=new r.a({id:"more",use:"more-usage",viewBox:"0 0 515.555 515.555",content:'<symbol viewBox="0 0 515.555 515.555" xmlns="http://www.w3.org/2000/svg" id="more"><path d="M496.679 212.208c25.167 25.167 25.167 65.971 0 91.138s-65.971 25.167-91.138 0-25.167-65.971 0-91.138 65.971-25.167 91.138 0M303.347 212.208c25.167 25.167 25.167 65.971 0 91.138s-65.971 25.167-91.138 0-25.167-65.971 0-91.138 65.971-25.167 91.138 0M110.014 212.208c25.167 25.167 25.167 65.971 0 91.138s-65.971 25.167-91.138 0-25.167-65.971 0-91.138 65.971-25.167 91.138 0" /></symbol>'}),I=(h.a.add(f),f);n(23);var L=class{constructor(t=[]){this.menuOptions=t,this.isOpen=!1,this.onMenuOpen=this.onMenuOpen.bind(this),this.onMenuClose=this.onMenuClose.bind(this),this.dropdownElement=null,this.menuBtn=null,this.coordX=0,this.coordY=0,this.clickAwayListener=this.clickAwayListener.bind(this),this.events()}events(){document.addEventListener("click",this.clickAwayListener)}removeListeners(){document.removeEventListener("click",this.clickAwayListener)}clickAwayListener(t){this.menuBtn.contains(t.target)||this.dropdownElement.contains(t.target)||this.onMenuClose()}createDropdownMenuItem({name:t,handler:e}){const n=document.createElement("div");return n.className="menu__dropdown-item",n.innerHTML=t,n.onclick=e,n}createDropdownMenu(){const t=document.createElement("div");return t.className="menu__dropdown",this.menuOptions.forEach(e=>{t.appendChild(this.createDropdownMenuItem(e))}),t}createButton(){const t=document.createElement("div");return t.innerHTML=`<svg class="icon"><use xlink:href="#${I.id}" /></svg>`,t.className="menu__button",t.onclick=this.onMenuOpen,t}onMenuOpen(t){const e=this.menuBtn.getBoundingClientRect();this.dropdownElement.style.top=e.top+this.menuBtn.clientHeight-5+"px",this.dropdownElement.style.left=e.left+"px",this.dropdownElement.classList.add("menu__dropdown--open")}onMenuClose(){this.dropdownElement.classList.remove("menu__dropdown--open")}render(){const t=document.createElement("div");t.className="menu",this.menuBtn=this.createButton();const e=document.getElementById("portal");return this.dropdownElement=this.createDropdownMenu(),t.appendChild(this.menuBtn),e.appendChild(this.dropdownElement),t}};n(24);var T=class{constructor(t){this.content=t}createElement(){document.createElement("div").className="modal"}render(){const t=document.createElement("div");t.className="modal-wrapper";const e=document.createElement("div");return e.className="modal",e.appendChild(this.content),t.appendChild(e),t}};var _=class{constructor(t){this.task=t,this.updateTask=this.updateTask.bind(this),this.deleteTask=this.deleteTask.bind(this),this.onEdit=this.onEdit.bind(this),this.hideModal=this.hideModal.bind(this),this.onDeleteColumn=this.onDeleteColumn.bind(this),this.updateColumnId=this.updateColumnId.bind(this),this.menuOptions=[{name:"Редактировать",handler:this.updateTask},{name:"Удалить",handler:this.deleteTask}],this.menu=new L(this.menuOptions),this.root=document.createElement("div"),this.modal=null,this.descriptionElement=null,this.subId=R.subscribe(this.onDeleteColumn),this.onTaskMovedSubId=z.subscribe(this.updateColumnId)}updateColumnId(t){this.task.columnId=t}onDeleteColumn(t){t===this.task.columnId&&this.deleteTask()}deleteTask(){p.delete(this.task.id).then(()=>{this.menu.removeListeners(),R.unsubscribe(this.subId),z.unsubscribe(this.onTaskMovedSubId),this.root.remove(),this.menu.onMenuClose()}).catch(t=>console.log(t))}updateTask(){this.menu.onMenuClose(),this.showModal()}onEdit(t){this.task.description=t,this.descriptionElement.innerText=t}showModal(){const t=document.createElement("div");t.className="modal-content";const e=new w({onSubmit:this.onEdit,onCloseHandler:this.hideModal,inputValue:this.task.description,taskId:this.task.id}).render();t.appendChild(e),this.modal=new T(t).render(),this.root.appendChild(this.modal)}hideModal(){this.modal.remove()}createTaskElement(){const t=document.createElement("div");t.className="task__inner";const e=document.createElement("div");e.innerText=this.task.description,e.className="task__text",this.descriptionElement=e,t.appendChild(e);const n=document.createElement("div");n.className="task__actions",t.appendChild(n);const s=this.menu.render();return n.appendChild(s),t}render(){return this.root.className="task",this.root.setAttribute("data-id",this.task.id),this.root.appendChild(this.createTaskElement()),this.root}};var M=class{constructor(t=[],e){this.tasks=t,this.columnId=e,this.tasksListElement=document.createElement("div"),this.tasksListElement.className="tasks-list",this.addTask=this.addTask.bind(this),this.onDeleteColumn=this.onDeleteColumn.bind(this),this.addTaskEventSubId=U.subscribe(this.addTask),this.deleteColumnEventSubId=R.subscribe(this.onDeleteColumn)}onDeleteColumn(t){this.columnId===t&&(U.unsubscribe(this.addTaskEventSubId),R.unsubscribe(this.deleteColumnEventSubId))}addTask(t){this.columnId===t.columnId&&(this.tasks.push(t),this.tasksListElement.appendChild(new _(t).render()))}render(){return this.tasks.forEach(t=>{this.tasksListElement.appendChild(new _(t).render())}),this.tasksListElement.setAttribute("data-id",this.columnId),this.tasksListElement}};var N=class{constructor({title:t}){this.title=t}save(){if(this.title)return o.ref("columns").push({title:this.title})}static edit(t,e){if(t)return o.ref("columns/"+t).update({title:e})}static fetchAll(){return o.ref("columns").once("value").then(t=>{const e=[];return t.forEach(t=>{e.push({id:t.key,...t.val()})}),e})}static delete(t){return o.ref("columns/"+t).remove()}};var x=class extends m{constructor({onCloseHandler:t,inputValue:e,onSubmit:n,columnId:s}){super({placeholder:"Введите название колонки",btnTitle:"Редактировать колонку",inputName:"title",inputValue:e,onCloseHandler:t}),this.columnId=s,this.onSubmitCallback=n}onSubmit(t){super.onSubmit(t),N.edit(this.columnId,this.formData.title).then(t=>{this.onSubmitCallback(this.formData.title),this.onCloseClick(this.formData.title)}).catch(t=>console.log(t))}render(){return this.root.classList.add("add-column-element"),super.render()}},A=n(9);var S=class{constructor({id:t,title:e,tasks:n=[]}){this.id=t,this.title=e,this.tasks=n,this.updateColumn=this.updateColumn.bind(this),this.deleteColumn=this.deleteColumn.bind(this),this.onEdit=this.onEdit.bind(this),this.hideModal=this.hideModal.bind(this),this.saveColumnPosition=this.saveColumnPosition.bind(this),this.menuOptions=[{name:"Редактировать",handler:this.updateColumn},{name:"Удалить",handler:this.deleteColumn}],this.menu=new L(this.menuOptions),this.modal=null,this.columnTitleElement=null,this.root=document.createElement("div")}updateColumn(){this.menu.onMenuClose(),this.showModal()}deleteColumn(){N.delete(this.id).then(()=>{this.menu.removeListeners(),R.fire(this.id),this.root.remove(),this.menu.onMenuClose()})}onEdit(t){this.columnTitleElement.innerText=t}showModal(){const t=document.createElement("div");t.className="modal-content";const e=new x({onSubmit:this.onEdit,onCloseHandler:this.hideModal,inputValue:this.title,columnId:this.id}).render();t.appendChild(e),this.modal=new T(t).render(),this.root.appendChild(this.modal)}hideModal(){this.modal.remove()}createAddNewTaskElement(){return new g(this.id).render()}createHeaderElement(){const t=document.createElement("div");t.className="column__header";const e=document.createElement("div");e.innerText=this.title,e.className="column__title",this.columnTitleElement=e,t.appendChild(e);const n=document.createElement("div");n.className="column__actions";const s=this.menu.render();return n.appendChild(s),t.appendChild(n),t}saveColumnPosition(t){if(t.from.dataset.id!==this.id){const e=t.clone.dataset.id;p.edit(e,{columnId:this.id}).then(()=>{z.fire(this.id)}).catch(t=>console.log(t))}}render(){this.root.className="column-wrapper";const t=document.createElement("div");t.classList="column";const e=this.createHeaderElement();t.appendChild(e);const n=new M(this.tasks,this.id).render(),s=(A.a.create(n,{group:"columns",ghostClass:"task__ghost",chosenClass:"task__chosen",dragClass:"task__drag",forceFallback:!0,onAdd:this.saveColumnPosition}),document.createElement("div"));return s.className="tasks-wrapper",s.appendChild(n),t.appendChild(s),t.appendChild(this.createAddNewTaskElement()),this.root.appendChild(t),this.root}};var D=class extends m{constructor(t){super({placeholder:"Введите название колонки",btnTitle:"Добавить колонку",inputName:"title",onCloseHandler:t})}onSubmit(t){super.onSubmit(t),this.formChanged&&new N({title:this.formData.title}).save().then(t=>{this.onCloseClick(),j.fire({id:t.key,title:this.formData.title})}).catch(t=>console.log(t))}render(){return this.root.classList.add("add-column-element"),super.render()}};var B=class extends C{constructor(){super()}getElement(){return this.open?new D(this.onClose).render():new k("Добавить еще одну колонку",this.onAdd).render()}render(){return super.render(),this.root.className="add-column-element",this.root}};n(25);var y=class{constructor(t=[]){this.columns=t,this.addColumnElement=null,this.root=document.createElement("div"),this.columnListElement=document.createElement("div"),this.appendColumn=this.appendColumn.bind(this),this.subId=j.subscribe(this.appendColumn)}appendColumn(t){this.addColumnElement.insertAdjacentElement("beforebegin",this.getColumnElement(t))}getCreateNewColumnElement(){const t=document.createElement("div");return t.className="column-wrapper",t.appendChild((new B).render()),t}getColumnElement(t){return new S(t).render()}render(){return this.columns.forEach(t=>{this.columnListElement.appendChild(this.getColumnElement(t))}),this.addColumnElement=this.getCreateNewColumnElement(),this.columnListElement.appendChild(this.addColumnElement),this.columnListElement.className="column-list",this.root.appendChild(this.columnListElement),this.root.className="board",this.root}};n(26);var H=class{constructor(t){this.root=document.createElement("header"),this.onLogin=this.onLogin.bind(this),this.onLogout=this.onLogout.bind(this),this.createUserIfoBlock=this.createUserIfoBlock.bind(this),this.user=t,this.buttonElement=null,this.userInfoElement=null,this.btnLoginText="Войти с Google",this.btnLogoutText="Выйти"}onLogin(){this.user.login().then(()=>{this.buttonElement.innerText=this.btnLogoutText,this.buttonElement.onclick=this.onLogout,this.userInfoElement=this.createUserIfoBlock(this.user.user.displayName),this.root.prepend(this.userInfoElement)})}onLogout(){this.user.logout().then(()=>{this.buttonElement.innerText=this.btnLoginText,this.buttonElement.onclick=this.onLogin,this.userInfoElement.innerText=""})}createLoginButton(){const t=document.createElement("button");return t.className="header__login-btn",t.type="button",t.innerText=this.btnLoginText,t.onclick=this.onLogin,t}createUserIfoBlock(t){const e=document.createElement("div");return e.className="header__user-info",e.innerText=t,e}render(){return this.root.className="header",this.buttonElement=this.createLoginButton(),this.root.appendChild(this.buttonElement),this.root}};var O=class{constructor(){this.isAuthenticated=!1,this.user=null}login(){return i.a.auth().signInWithPopup(d).then(t=>{this.user=t.user,this.isAuthenticated=!0}).catch(t=>console.log(t))}logout(){return i.a.auth().signOut().then(()=>{this.isAuthenticated=!1}).catch(t=>console.log(t))}};var V=class{constructor(){this.root=document.getElementById("app"),this.init=this.init.bind(this),this.render=this.render.bind(this),this.user=new O}async init(){const[t,e]=await Promise.all([N.fetchAll(),p.fetchAll()]);return t.map(t=>{const n=e.filter(e=>e.columnId===t.id);return{...t,tasks:n}})}render(t){this.root.appendChild(new H(this.user).render()),this.root.appendChild(new y(t).render())}};var P=class{constructor(){this.handlers=new Map,this.count=0}subscribe(t){return this.handlers.set(++this.count,t),this.count}unsubscribe(t){this.handlers.delete(t)}fire(t){this.handlers.forEach(e=>{e(t)})}};const j=new P,U=new P,R=new P,z=new P;document.addEventListener("DOMContentLoaded",()=>{const t=new V;t.init().then(e=>{t.render(e)})})}],[[27,1,2]]]);